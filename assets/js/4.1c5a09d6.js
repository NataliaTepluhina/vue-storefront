(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{76:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"integration-with-magento-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#integration-with-magento-2","aria-hidden":"true"}},[t._v("#")]),t._v(" Integration with Magento 2")]),a("h2",{attrs:{id:"integrating-magento2-with-your-local-instance"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#integrating-magento2-with-your-local-instance","aria-hidden":"true"}},[t._v("#")]),t._v(" Integrating Magento2 with your local instance")]),a("p",[t._v("As a first step, you need to to install "),a("a",{attrs:{href:"https://github.com/DivanteLtd/mage2vuestorefront",target:"_blank",rel:"noopener noreferrer"}},[t._v("mage2vuestorefront ")]),t._v(":")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/DivanteLtd/mage2vuestorefront.git mage2vs\n"),a("span",{attrs:{class:"token function"}},[t._v("cd")]),t._v(" mage2vs/src\nyarn "),a("span",{attrs:{class:"token function"}},[t._v("install")]),t._v("\n")])]),a("p",[t._v("The tool is using Magento2 API via OAuth authorization, so you need to prepare Magento Integration access at first. Go to your Magento2 admin panel and click: "),a("em",[t._v("System -> Integrations")])]),a("p",[a("img",{attrs:{src:"/vue-storefront/magento_1.png",alt:"Magento Admin Panel"}})]),a("p",[t._v("Then click "),a("em",[t._v("Add new integration")]),t._v(" and just fill:")]),a("ul",[a("li",[t._v("name (whatever)")]),a("li",[t._v("your password to confirm the changes,")]),a("li",[t._v("check Catalog, Sales, My Account and Carts on API permissions tab — save")])]),a("p",[a("img",{attrs:{src:"/vue-storefront/magento_2.png",alt:"Magento API"}})]),a("p",[t._v("In the result you’ll click "),a("em",[t._v("Activate")]),t._v(" and get some oauth access tokens:")]),a("p",[a("img",{attrs:{src:"/vue-storefront/magento_3.png",alt:"Magento tokens"}})]),a("p",[t._v("Now please edit the "),a("code",[t._v("src/config.js")]),t._v(" file in your "),a("code",[t._v("mage2vuestorefront")]),t._v(" directory to set the following section:")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("magento"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  url"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" process"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token constant"}},[t._v("MAGENTO_URL")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"http://your-magento-url.com/rest/"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("<")]),a("span",{attrs:{class:"token operator"}},[t._v("-")]),t._v(" change to your Magento "),a("span",{attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{attrs:{class:"token constant"}},[t._v("URL")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  consumerKey"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" process"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token constant"}},[t._v("MAGENTO_CONSUMER_KEY")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'alva6h6hku9qxrpfe02c2jalopx7od1q'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  consumerSecret"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" process"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token constant"}},[t._v("MAGENTO_CONSUMER_SECRET")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'9tgfpgoojlx9tfy21b8kw7ssfu2aynpm'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  accessToken"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" process"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token constant"}},[t._v("MAGENTO_ACCESS_TOKEN")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'rw5w0si9imbu45h3m9hkyrfr4gjina8q'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  accessTokenSecret"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" process"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),a("span",{attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{attrs:{class:"token constant"}},[t._v("MAGENTO_ACCESS_TOKEN_SECRET")]),t._v(" "),a("span",{attrs:{class:"token operator"}},[t._v("||")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v("'00y9dl4vpxgcef3gn5mntbxtylowjcc9'")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])]),a("p",[t._v("As you can see, you can override the defaults by ENV variables as well.")]),a("p",[t._v("The rest of config.js entries points out to your "),a("code",[t._v("vue-storefront-api")]),t._v(" based Docker and Redis instances which are required by "),a("code",[t._v("mage2nosql")]),t._v(" to work.")]),a("p",[t._v("To import all the Products, Categories and other important stuff to your Elastic Search instance you should run the following commands (the sequence of commands is important  -  as for example "),a("code",[t._v("node cli.js categories")]),t._v(" populates Redis cache for the further use of "),a("code",[t._v("node cli.js")]),t._v(" products and so on)")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("node cli.js taxrule\nnode cli.js attributes\nnode cli.js categories\nnode cli.js productcategories\nnode cli.js products\n")])]),a("p",[t._v("It’s safe to run these commands over and over as they’re doing "),a("code",[t._v("upsert")]),t._v(" operation  - so inserts or updates the existing records.")]),a("p",[a("code",[t._v("cli.js")]),t._v(" has a lot of other modes to be run in. Dynamic changes, queue support etc. You may experiment with them, but remember  -  the basic sequence for syncing the whole Magento2 database is like just shown.")]),a("h2",{attrs:{id:"synchronizing-orders-and-magento-images"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#synchronizing-orders-and-magento-images","aria-hidden":"true"}},[t._v("#")]),t._v(" Synchronizing orders and Magento images")]),a("p",[t._v("As you should have the products and categories already synchronized you may want to send some orders back to Magento or synchronize the shopping carts in the real time.")]),a("p",[a("code",[t._v("vue-storefront-api")]),t._v(" is responsible for this write access to Magento. You may want just edit your "),a("code",[t._v("conf/local.json")]),t._v(" within "),a("code",[t._v("vue-storefront-api")]),t._v(" directory to set the OAuth Magento API access ("),a("code",[t._v("magento2")]),t._v(" section):")]),a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{attrs:{class:"token property"}},[t._v('"magento2"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"url"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"http://your-magento-url.com"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"imgUrl"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"http://your-magento-url.com/media/catalog/product"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"assetPath"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"/../var/magento2-sample-data/pub/media"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"api"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"url"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"http://your-magento-url.com/rest/"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"consumerKey"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"alva6h6hku9qxrpfe02c2jalopx7od1q"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"consumerSecret"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"9tgfpgoojlx9tfy21b8kw7ssfu2aynpm"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"accessToken"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"rw5w0si9imbu45h3m9hkyrfr4gjina8q"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"accessTokenSecret"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('"00y9dl4vpxgcef3gn5mntbxtylowjcc9"')]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])]),a("p",[t._v("To allow "),a("code",[t._v("vue-storefront-api")]),t._v(" to resize your Magento’s images, please edit the "),a("code",[t._v("imgUrl")]),t._v(" property under "),a("code",[t._v("magento2")]),t._v(" section and add your Magento’s domain to "),a("code",[t._v("imageable")]),t._v(" -> "),a("code",[t._v("whitelist")]),t._v(".")]),a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{attrs:{class:"token property"}},[t._v('"imageable"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"namespace"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token string"}},[t._v('""')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"maxListeners"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("512")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"imageSizeLimit"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("1024")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"timeouts"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"convert"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("15000")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"identify"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("300")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"download"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token number"}},[t._v("5000")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{attrs:{class:"token property"}},[t._v('"whitelist"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"allowedHosts"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v('".*your-magento-url.com"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v('".*divante.pl"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v('".*vuestorefront.io"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v('"localhost"')]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),a("span",{attrs:{class:"token property"}},[t._v('"trustedHosts"')]),a("span",{attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v('".*your-magento-url.com"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v('".*divante.pl"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v('".*vuestorefront.io"')]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{attrs:{class:"token string"}},[t._v('"localhost"')]),t._v("\n      "),a("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])]),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),a("p",[t._v("After changing the config files you need to restart "),a("code",[t._v("yarn dev")])])]),a("p",[t._v("After setting up the Magento access you just need to run the Order2Magento worker which works on Redis based queue to process all the orders made by users:")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("yarn o2m\n")])]),a("p",[t._v("The code of this script is "),a("a",{attrs:{href:"https://github.com/DivanteLtd/vue-storefront-api/blob/master/src/worker/order_to_magento2.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("located here")]),t._v(" -  so you can easily check how it’s working.")]),a("h2",{attrs:{id:"synchronizing-shopping-carts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#synchronizing-shopping-carts","aria-hidden":"true"}},[t._v("#")]),t._v(" Synchronizing shopping carts")]),a("p",[t._v("By default shopping carts are not synchronized in the real time  -  just after the order is placed, Magento2 cart is created etc.")]),a("p",[t._v("This was limiting behavior because you need to keep the user cart most current all the time to get Magento2 shopping cart promotion rules into the action .")]),a("p",[t._v("We have option for that! If you have Magento2 API configured within the "),a("code",[t._v("vue-storefront-api")]),t._v(" you just need to go to "),a("code",[t._v("vue-storefront/conf/local.json")]),t._v(" and add")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("synchronize"),a("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{attrs:{class:"token boolean"}},[t._v("true")]),a("span",{attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),a("p",[t._v("to "),a("code",[t._v("cart")]),t._v(" section. Please check the "),a("a",{attrs:{href:"https://github.com/DivanteLtd/vue-storefront/blob/193cf44a6e936136fc19e22b45fe8dbc4b33f844/config/default.json#L8",target:"_blank",rel:"noopener noreferrer"}},[t._v("default config for reference")]),t._v(".")])])}],!1,null,null,null);s.default=e.exports}}]);